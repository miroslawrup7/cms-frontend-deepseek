import{API_BASE,getProfile}from"./api.js";function buildHeader(){return'\n<header class="site-header">\n  <div class="nav-wrap">\n    <a class="brand" href="/">CMS</a>\n    <nav class="nav-actions">\n      <a id="btnLogin" class="btn btn--ghost" href="/login.html">Zaloguj</a>\n      <a id="btnRegister" class="btn btn--primary" href="/register.html">Zarejestruj</a>\n\n      <a id="adminNavBtn" data-role="admin" class="btn btn--ghost hidden" href="/admin.html">Panel admina</a>\n\n      <div id="userMenu" class="user-menu" style="display:none">\n        <button id="userToggle" class="user-chip" aria-expanded="false">\n          <span id="userName">UÅ¼ytkownik</span>\n          <span class="user-avatar" aria-hidden="true">ðŸ‘¤</span>\n        </button>\n        <div id="userDropdown" class="user-dropdown" hidden>\n          <a id="newArticleBtn" href="/new-article.html" data-role="authorOrAdmin" class="btn btn--primary hidden">Dodaj artykuÅ‚</a>\n          <a id="linkAdmin" href="/admin.html" style="display:none">Panel admina</a>\n          <button id="btnLogout" type="button">Wyloguj</button>\n        </div>\n      </div>\n    </nav>\n  </div>\n</header>'}function injectHeader(){if(document.querySelector(".site-header"))return;const e=document.createElement("div");e.innerHTML=buildHeader(),document.body.prepend(e.firstElementChild)}function attachNextParam(){if(location.pathname.endsWith("/login.html")||location.pathname.endsWith("/register.html"))return;const e=encodeURIComponent(location.pathname+location.search),t=document.getElementById("btnLogin"),n=document.getElementById("btnRegister");t&&(t.href=`/login.html?next=${e}`),n&&(n.href=`/register.html?next=${e}`)}async function getMe(){return await getProfile()}function preventReloadOnSamePage(e){e&&e.addEventListener("click",t=>{new URL(e.getAttribute("href"),location.origin).pathname===location.pathname&&t.preventDefault()})}function wireUserMenu(e){const t=document.getElementById("btnLogin"),n=document.getElementById("btnRegister"),a=document.getElementById("userMenu"),i=document.getElementById("userName"),d=document.getElementById("linkAdmin"),o=document.getElementById("adminNavBtn"),r=document.getElementById("btnLogout"),l=document.getElementById("userToggle"),s=document.getElementById("userDropdown");if(t&&n&&a)if(s&&(s.setAttribute("hidden",""),s.style.display="none",l?.setAttribute("aria-expanded","false")),e){function c(){s&&(s.setAttribute("hidden",""),s.style.display="none",l?.setAttribute("aria-expanded","false"))}t.style.display="none",n.style.display="none",a.style.display="",i.textContent=e.username||e.email||"UÅ¼ytkownik","admin"===e.role?(d&&(d.style.display="block"),o&&(o.style.display="inline-flex")):(d&&(d.style.display="none"),o&&(o.style.display="none")),preventReloadOnSamePage(o),preventReloadOnSamePage(d),l?.addEventListener("click",e=>{e.stopPropagation();s&&!s.hasAttribute("hidden")?c():s&&(s.removeAttribute("hidden"),s.style.display="",l?.setAttribute("aria-expanded","true"))}),document.addEventListener("click",e=>{!s||s.hasAttribute("hidden")||e.target.closest(".user-menu")||c()}),r?.addEventListener("click",async()=>{try{await fetch(`${API_BASE}/api/auth/logout`,{method:"POST",credentials:"include"})}catch{}location.href="/"})}else t.style.display="",n.style.display="",a.style.display="none",attachNextParam()}function guardAdminPage(e){if(/\/admin\.html($|\?)/.test(location.pathname+location.search)){if(!e){const e=encodeURIComponent(location.pathname+location.search);return void(location.href=`/login.html?next=${e}`)}"admin"!==e.role&&(location.href="/")}}function setHeaderUI(e){const t=document.getElementById("btnLogin"),n=document.getElementById("btnRegister"),a=document.getElementById("adminNavBtn"),i=document.getElementById("userMenu"),d=document.getElementById("userName"),o=!!e,r="admin"===e?.role;t&&(t.style.display=o?"none":""),n&&(n.style.display=o?"none":""),i&&(i.style.display=o?"":"none"),d&&(d.textContent=o?e.username||e.email:""),a&&(a.style.display=r?"":"none"),document.querySelectorAll("[data-role]").forEach(t=>{const n=t.getAttribute("data-role"),a="user"===n&&o||"admin"===n&&r||"authorOrAdmin"===n&&("author"===e?.role||r);t.classList.toggle("hidden",!a)})}function guardPage(e=null,t=null){if(!t){const e=encodeURIComponent(location.pathname+location.search);return void(location.href=`/login.html?next=${e}`)}if(!e)return;"user"===e||t.role===e||"authorOrAdmin"===e&&("author"===t.role||"admin"===t.role)||(location.href="/")}document.addEventListener("DOMContentLoaded",async()=>{injectHeader(),attachNextParam();const e=await getMe();setHeaderUI(e),guardAdminPage(e),wireUserMenu(e)});
//# sourceMappingURL=header.js.map
