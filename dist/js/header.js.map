{"version":3,"file":"header.js","names":["API_BASE","getProfile","buildHeader","injectHeader","document","querySelector","wrapper","createElement","innerHTML","body","prepend","firstElementChild","attachNextParam","location","pathname","endsWith","next","encodeURIComponent","search","btnLogin","getElementById","btnRegister","href","async","getMe","preventReloadOnSamePage","link","addEventListener","e","URL","getAttribute","origin","preventDefault","wireUserMenu","me","userMenu","userName","linkAdmin","adminNavBtn","btnLogout","userToggle","dropdown","setAttribute","style","display","closeDropdown","textContent","username","email","role","stopPropagation","hasAttribute","removeAttribute","target","closest","fetch","method","credentials","guardAdminPage","test","setHeaderUI","loginBtn","registerBtn","adminBtn","isLogged","isAdmin","querySelectorAll","forEach","el","need","visible","classList","toggle","guardPage","requiredRole"],"sources":["header.js"],"mappings":"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","ignoreList":[],"sourcesContent":["import { API_BASE, getProfile } from './api.js'\r\n\r\n/* Zbuduj HTML nag≈Ç√≥wka */\r\nfunction buildHeader() {\r\n  return `\r\n<header class=\"site-header\">\r\n  <div class=\"nav-wrap\">\r\n    <a class=\"brand\" href=\"/\">CMS</a>\r\n    <nav class=\"nav-actions\">\r\n      <a id=\"btnLogin\" class=\"btn btn--ghost\" href=\"/login.html\">Zaloguj</a>\r\n      <a id=\"btnRegister\" class=\"btn btn--primary\" href=\"/register.html\">Zarejestruj</a>\r\n\r\n      <a id=\"adminNavBtn\" data-role=\"admin\" class=\"btn btn--ghost hidden\" href=\"/admin.html\">Panel admina</a>\r\n\r\n      <div id=\"userMenu\" class=\"user-menu\" style=\"display:none\">\r\n        <button id=\"userToggle\" class=\"user-chip\" aria-expanded=\"false\">\r\n          <span id=\"userName\">U≈ºytkownik</span>\r\n          <span class=\"user-avatar\" aria-hidden=\"true\">üë§</span>\r\n        </button>\r\n        <div id=\"userDropdown\" class=\"user-dropdown\" hidden>\r\n          <a id=\"newArticleBtn\" href=\"/new-article.html\" data-role=\"authorOrAdmin\" class=\"btn btn--primary hidden\">Dodaj artyku≈Ç</a>\r\n          <a id=\"linkAdmin\" href=\"/admin.html\" style=\"display:none\">Panel admina</a>\r\n          <button id=\"btnLogout\" type=\"button\">Wyloguj</button>\r\n        </div>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n</header>`\r\n}\r\n\r\n/* Wstrzyknij nag≈Ç√≥wek na poczƒÖtek <body> (raz) */\r\nfunction injectHeader() {\r\n  if (document.querySelector(\".site-header\")) return\r\n  const wrapper = document.createElement(\"div\")\r\n  wrapper.innerHTML = buildHeader()\r\n  document.body.prepend(wrapper.firstElementChild)\r\n}\r\n\r\n/* ?next= ‚Äì dodaj powr√≥t na bie≈ºƒÖcƒÖ stronƒô do link√≥w logowania/rejestracji */\r\nfunction attachNextParam() {\r\n\r\n  if (location.pathname.endsWith('/login.html') || location.pathname.endsWith('/register.html')) return\r\n\r\n  const next = encodeURIComponent(location.pathname + location.search)\r\n  const btnLogin = document.getElementById(\"btnLogin\")\r\n  const btnRegister = document.getElementById(\"btnRegister\")\r\n  if (btnLogin)    btnLogin.href = `/login.html?next=${next}`\r\n  if (btnRegister) btnRegister.href = `/register.html?next=${next}`\r\n}\r\n\r\n/* Pobierz profil (je≈õli zalogowany) */\r\nasync function getMe() {\r\n  return await getProfile() // zwraca obiekt lub null\r\n}\r\n\r\n/* Zapobiegaj prze≈Çadowaniu, gdy klikamy link prowadzƒÖcy na tƒô samƒÖ stronƒô */\r\nfunction preventReloadOnSamePage(link) {\r\n  if (!link) return\r\n  link.addEventListener('click', (e) => {\r\n    // Normalizujemy docelowƒÖ ≈õcie≈ºkƒô linku i obecnƒÖ ≈õcie≈ºkƒô\r\n    const targetPath = new URL(link.getAttribute('href'), location.origin).pathname\r\n    const currentPath = location.pathname\r\n    if (targetPath === currentPath) {\r\n      e.preventDefault() // ju≈º tu jeste≈õmy ‚Äì nic nie r√≥b\r\n    }\r\n  })\r\n}\r\n\r\n/* Zachowanie menu u≈ºytkownika, prze≈ÇƒÖczenia widoczno≈õci, logout */\r\nfunction wireUserMenu(me) {\r\n  const btnLogin    = document.getElementById(\"btnLogin\")\r\n  const btnRegister = document.getElementById(\"btnRegister\")\r\n  const userMenu    = document.getElementById(\"userMenu\")\r\n  const userName    = document.getElementById(\"userName\")\r\n  const linkAdmin   = document.getElementById(\"linkAdmin\")\r\n  const adminNavBtn = document.getElementById(\"adminNavBtn\")\r\n  const btnLogout   = document.getElementById(\"btnLogout\")\r\n  const userToggle  = document.getElementById(\"userToggle\")\r\n  const dropdown    = document.getElementById(\"userDropdown\")\r\n\r\n  if (!btnLogin || !btnRegister || !userMenu) return\r\n\r\n  // ‚Äî ZAWSZE zamknij dropdown na starcie ‚Äî\r\n  if (dropdown) {\r\n    dropdown.setAttribute(\"hidden\", \"\")\r\n    dropdown.style.display = \"none\"\r\n    userToggle?.setAttribute(\"aria-expanded\", \"false\")\r\n  }\r\n\r\n  if (me) {\r\n    // zalogowany\r\n    btnLogin.style.display = \"none\"\r\n    btnRegister.style.display = \"none\"\r\n    userMenu.style.display = \"\"\r\n\r\n    userName.textContent = me.username || me.email || \"U≈ºytkownik\"\r\n    if (me.role === \"admin\") {\r\n      if (linkAdmin)   linkAdmin.style.display = \"block\"\r\n      if (adminNavBtn) adminNavBtn.style.display = \"inline-flex\"\r\n    } else {\r\n      if (linkAdmin)   linkAdmin.style.display = \"none\"\r\n      if (adminNavBtn) adminNavBtn.style.display = \"none\"\r\n    }\r\n\r\n    // Zapobiegaj prze≈Çadowaniu, gdy ju≈º jeste≈õmy na admin.html\r\n    preventReloadOnSamePage(adminNavBtn)\r\n    preventReloadOnSamePage(linkAdmin)\r\n\r\n    function closeDropdown() {\r\n      if (!dropdown) return\r\n      dropdown.setAttribute(\"hidden\", \"\")\r\n      dropdown.style.display = \"none\"\r\n      userToggle?.setAttribute(\"aria-expanded\", \"false\")\r\n    }\r\n    function openDropdown() {\r\n      if (!dropdown) return\r\n      dropdown.removeAttribute(\"hidden\")\r\n      dropdown.style.display = \"\"\r\n      userToggle?.setAttribute(\"aria-expanded\", \"true\")\r\n    }\r\n\r\n    // Toggle dropdowna\r\n    userToggle?.addEventListener(\"click\", (e) => {\r\n      e.stopPropagation()\r\n      const open = dropdown && !dropdown.hasAttribute(\"hidden\")\r\n      open ? closeDropdown() : openDropdown()\r\n    })\r\n\r\n    // Zamknij po klikniƒôciu poza menu\r\n    document.addEventListener(\"click\", (e) => {\r\n      if (dropdown && !dropdown.hasAttribute(\"hidden\") && !e.target.closest(\".user-menu\")) {\r\n        closeDropdown()\r\n      }\r\n    })\r\n\r\n    // Logout\r\n    btnLogout?.addEventListener(\"click\", async () => {\r\n      try {\r\n        await fetch(`${API_BASE}/api/auth/logout`, { method: \"POST\", credentials: \"include\" })\r\n      } catch {}\r\n      location.href = \"/\"\r\n    })\r\n  } else {\r\n    // niezalogowany\r\n    btnLogin.style.display = \"\"\r\n    btnRegister.style.display = \"\"\r\n    userMenu.style.display = \"none\"\r\n    attachNextParam()\r\n  }\r\n}\r\n\r\n/* Stra≈ºnik strony admina */\r\nfunction guardAdminPage(me) {\r\n  const isAdminPage = /\\/admin\\.html($|\\?)/.test(location.pathname + location.search)\r\n  if (!isAdminPage) return\r\n\r\n  if (!me) {\r\n    const next = encodeURIComponent(location.pathname + location.search)\r\n    location.href = `/login.html?next=${next}`\r\n    return\r\n  }\r\n  if (me.role !== \"admin\") {\r\n    location.href = \"/\"\r\n  }\r\n}\r\n\r\n/* Ustaw UI nag≈Ç√≥wka w zale≈ºno≈õci od stanu zalogowania */\r\nfunction setHeaderUI(me) {\r\n  const loginBtn   = document.getElementById(\"btnLogin\")\r\n  const registerBtn= document.getElementById(\"btnRegister\")\r\n  const adminBtn   = document.getElementById(\"adminNavBtn\")\r\n  const userMenu   = document.getElementById(\"userMenu\")\r\n  const userName   = document.getElementById(\"userName\")\r\n\r\n  const isLogged = !!me\r\n  const isAdmin  = me?.role === \"admin\"\r\n\r\n  if (loginBtn)    loginBtn.style.display = isLogged ? \"none\" : \"\"\r\n  if (registerBtn) registerBtn.style.display = isLogged ? \"none\" : \"\"\r\n  if (userMenu)    userMenu.style.display   = isLogged ? \"\" : \"none\"\r\n  if (userName)    userName.textContent     = isLogged ? (me.username || me.email) : \"\"\r\n  if (adminBtn)    adminBtn.style.display   = isAdmin ? \"\" : \"none\"\r\n\r\n  // obs≈Çuga element√≥w z data-role\r\n  document.querySelectorAll(\"[data-role]\").forEach(el => {\r\n    const need = el.getAttribute(\"data-role\")\r\n    const visible =\r\n      (need === \"user\" && isLogged) ||\r\n      (need === \"admin\" && isAdmin) ||\r\n      (need === \"authorOrAdmin\" && (me?.role === \"author\" || isAdmin))\r\n    el.classList.toggle(\"hidden\", !visible)\r\n  })\r\n}\r\n\r\n/* Og√≥lny guard ‚Äì u≈ºywaj na stronach wymagajƒÖcych roli */\r\nfunction guardPage(requiredRole = null, me = null) {\r\n  if (!me) {\r\n    const next = encodeURIComponent(location.pathname + location.search)\r\n    location.href = `/login.html?next=${next}`\r\n    return\r\n  }\r\n  if (!requiredRole) return\r\n  const ok =\r\n    requiredRole === \"user\" ||\r\n    me.role === requiredRole ||\r\n    (requiredRole === \"authorOrAdmin\" && (me.role === \"author\" || me.role === \"admin\"))\r\n  if (!ok) location.href = \"/\"\r\n}\r\n\r\n/* Inicjalizacja */\r\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\r\n  injectHeader()\r\n  attachNextParam()\r\n\r\n  const me = await getMe()       // pobranie profilu (lub null)\r\n  setHeaderUI(me)                // przestaw widoczno≈õƒá element√≥w\r\n  guardAdminPage(me)             // zostaw ‚Äì Tw√≥j istniejƒÖcy guard admina\r\n  wireUserMenu(me)               // menu u≈ºytkownika / logout\r\n})\r\n"]}