{"version":3,"file":"nav.js","names":["API_BASE","getParam","name","URL","window","location","href","searchParams","get","attachNextParam","next","encodeURIComponent","pathname","search","login","document","getElementById","register","async","hydrateUserMenu","btnLogin","btnRegister","userMenu","userName","linkAdmin","btnLogout","userToggle","dropdown","res","fetch","credentials","ok","Error","me","json","style","display","textContent","username","email","role","addEventListener","hasAttribute","setAttribute","removeAttribute","method"],"sources":["nav.js"],"mappings":"OAASA,aAAgB,WAGzB,SAASC,SAASC,GAEd,OADY,IAAIC,IAAIC,OAAOC,SAASC,MACzBC,aAAaC,IAAIN,EAChC,CAGA,SAASO,kBACL,MAAMC,EAAOC,mBAAmBN,SAASO,SAAWP,SAASQ,QACvDC,EAAQC,SAASC,eAAe,YAChCC,EAAWF,SAASC,eAAe,eACrCF,IAAUA,EAAMR,KAAO,oBAAoBI,KAC3CO,IAAUA,EAASX,KAAO,uBAAuBI,IACzD,CAGAQ,eAAeC,kBACX,MAAMC,EAAWL,SAASC,eAAe,YACnCK,EAAcN,SAASC,eAAe,eACtCM,EAAWP,SAASC,eAAe,YACnCO,EAAWR,SAASC,eAAe,YACnCQ,EAAYT,SAASC,eAAe,aACpCS,EAAYV,SAASC,eAAe,aACpCU,EAAaX,SAASC,eAAe,cACrCW,EAAWZ,SAASC,eAAe,gBAGzC,GAAKI,GAAaC,GAAgBC,EAElC,IACI,MAAMM,QAAYC,MAAM,GAAG7B,6BAA8B,CAAE8B,YAAa,YACxE,IAAKF,EAAIG,GAAI,MAAM,IAAIC,MACvB,MAAMC,QAAWL,EAAIM,OAGrBd,EAASe,MAAMC,QAAU,OACzBf,EAAYc,MAAMC,QAAU,OAC5Bd,EAASa,MAAMC,QAAU,GAEzBb,EAASc,YAAcJ,EAAGK,UAAYL,EAAGM,OAAS,aAClC,UAAZN,EAAGO,OAAkBhB,EAAUW,MAAMC,QAAU,SAGnDV,EAAWe,iBAAiB,QAAS,MACpBd,EAASe,aAAa,WACvBf,EAASgB,aAAa,SAAU,IAAKjB,EAAWiB,aAAa,gBAAgB,WAClFhB,EAASiB,gBAAgB,UAAWlB,EAAWiB,aAAa,gBAAgB,WAIvFlB,EAAUgB,iBAAiB,QAASvB,gBAC1BW,MAAM,GAAG7B,2BAA4B,CAAE6C,OAAQ,OAAQf,YAAa,YAC1EzB,SAASC,KAAO,KAExB,CAAE,MAEEc,EAASe,MAAMC,QAAU,GACzBf,EAAYc,MAAMC,QAAU,GAC5Bd,EAASa,MAAMC,QAAU,OACzB3B,iBACJ,CACJ,CAEAM,SAAS0B,iBAAiB,mBAAoB,KAC1CtB,kBACAV","ignoreList":[],"sourcesContent":["import { API_BASE } from './api.js'\r\n\r\n// helper: pobierz parametr z URL\r\nfunction getParam(name) {\r\n    const url = new URL(window.location.href)\r\n    return url.searchParams.get(name)\r\n}\r\n\r\n// Ustal „next” przy klikaniu Logowanie/Rejestracja\r\nfunction attachNextParam() {\r\n    const next = encodeURIComponent(location.pathname + location.search)\r\n    const login = document.getElementById(\"btnLogin\")\r\n    const register = document.getElementById(\"btnRegister\")\r\n    if (login)    login.href = `/login.html?next=${next}`\r\n    if (register) register.href = `/register.html?next=${next}`\r\n}\r\n\r\n// Pokaż/ukryj menu zależnie od sesji\r\nasync function hydrateUserMenu() {\r\n    const btnLogin = document.getElementById(\"btnLogin\")\r\n    const btnRegister = document.getElementById(\"btnRegister\")\r\n    const userMenu = document.getElementById(\"userMenu\")\r\n    const userName = document.getElementById(\"userName\")\r\n    const linkAdmin = document.getElementById(\"linkAdmin\")\r\n    const btnLogout = document.getElementById(\"btnLogout\")\r\n    const userToggle = document.getElementById(\"userToggle\")\r\n    const dropdown = document.getElementById(\"userDropdown\")\r\n\r\n    // brak elementów – nic nie robimy\r\n    if (!btnLogin || !btnRegister || !userMenu) return\r\n\r\n    try {\r\n        const res = await fetch(`${API_BASE}/api/users/profile`, { credentials: \"include\" })\r\n        if (!res.ok) throw new Error()\r\n        const me = await res.json()\r\n\r\n        // zalogowany\r\n        btnLogin.style.display = \"none\"\r\n        btnRegister.style.display = \"none\"\r\n        userMenu.style.display = \"\"\r\n\r\n        userName.textContent = me.username || me.email || \"Użytkownik\"\r\n        if (me.role === \"admin\") linkAdmin.style.display = \"block\"\r\n\r\n        // dropdown toggle\r\n        userToggle.addEventListener(\"click\", () => {\r\n            const open = dropdown.hasAttribute(\"hidden\") ? false : true\r\n            if (open) { dropdown.setAttribute(\"hidden\", \"\"); userToggle.setAttribute(\"aria-expanded\",\"false\") }\r\n            else { dropdown.removeAttribute(\"hidden\"); userToggle.setAttribute(\"aria-expanded\",\"true\") }\r\n        })\r\n\r\n        // wylogowanie\r\n        btnLogout.addEventListener(\"click\", async () => {\r\n            await fetch(`${API_BASE}/api/auth/logout`, { method: \"POST\", credentials: \"include\" })\r\n            location.href = \"/\" // powrót na stronę główną\r\n        })\r\n    } catch {\r\n        // niezalogowany\r\n        btnLogin.style.display = \"\"\r\n        btnRegister.style.display = \"\"\r\n        userMenu.style.display = \"none\"\r\n        attachNextParam()\r\n    }\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n    hydrateUserMenu()\r\n    attachNextParam()\r\n})\r\n"]}