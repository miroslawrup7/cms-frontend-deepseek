import{API_BASE}from"./api.js";const limit=5;let totalPages=1,currentPage=1,q="",sort="newest";const container=document.getElementById("articles-container"),pageInfo=document.getElementById("page-info"),prevBtn=document.getElementById("prev"),nextBtn=document.getElementById("next"),qInput=document.getElementById("q"),sortSel=document.getElementById("sort");function readStateFromUrl(){const t=new URLSearchParams(location.search);currentPage=Math.max(1,parseInt(t.get("page")||"1",10)),q=(t.get("q")||"").trim(),sort=t.get("sort")||"newest",qInput&&(qInput.value=q),sortSel&&(sortSel.value=sort)}function syncUrl(){const t=new URLSearchParams;currentPage>1&&t.set("page",String(currentPage)),q&&t.set("q",q),sort&&"newest"!==sort&&t.set("sort",sort);const e=t.toString()?`/?${t.toString()}`:"/";history.replaceState(null,"",e);try{sessionStorage.setItem("cms:lastListURL",e)}catch{}}function renderArticles(t){if(!t||0===t.length)return void(container.innerHTML="<p>Brak artyku≈Ç√≥w.</p>");const e=t.map(t=>{const e=`/article.html?id=${t._id}`,n=t.thumbnail?`<img class="article-thumb" src="${API_BASE}/${t.thumbnail}" alt="">`:"",r=(t.content||"").slice(0,180)+(t.content&&t.content.length>180?"‚Ä¶":""),a=`\n      <div class="article-meta">\n        <span>üëç ${t.likesCount||0}</span>\n        <span>üí¨ ${t.commentCount||0}</span>\n      </div>`;return`\n      <article class="article-card">\n        <a class="article-cover" href="${e}">${n}</a>\n        <div class="article-body">\n          <h2 class="article-title"><a href="${e}">${t.title}</a></h2>\n          <p class="article-excerpt">${r}</p>\n          ${a}\n        </div>\n      </article>\n    `}).join("");container.innerHTML=e}function updatePaginationUI(){pageInfo.textContent=`Strona ${currentPage} z ${totalPages}`,prevBtn.disabled=currentPage<=1,nextBtn.disabled=currentPage>=totalPages;const t=document.getElementById("pagination");t&&(t.style.display=totalPages>1?"":"none")}async function loadArticles(t=1){container.innerHTML="<p>≈Åadowanie‚Ä¶</p>",pageInfo.textContent="";const e=new URLSearchParams({page:String(t),limit:String(5),...q?{q}:{},...sort?{sort}:{}});try{const n=await fetch(`${API_BASE}/api/articles?${e.toString()}`,{method:"GET",credentials:"include"}),r=await n.json();if(!n.ok)throw new Error(r?.message||`B≈ÇƒÖd ${n.status}`);const a=r.articles||[],s=Number(r.total||0),c=Math.max(1,Math.ceil(s/5));if(0===s)return currentPage=1,totalPages=1,container.innerHTML="<p>Brak artyku≈Ç√≥w.</p>",updatePaginationUI(),void syncUrl();if(t>c)return currentPage=c,totalPages=c,syncUrl(),void await loadArticles(currentPage);totalPages=c,renderArticles(a),updatePaginationUI()}catch(t){container.innerHTML=`<p style="color:crimson">${t.message||"B≈ÇƒÖd ≈Çadowania"}</p>`,pageInfo.textContent="",prevBtn.disabled=!0,nextBtn.disabled=!0}}prevBtn.addEventListener("click",()=>{currentPage>1&&(currentPage--,syncUrl(),loadArticles(currentPage))}),nextBtn.addEventListener("click",()=>{currentPage<totalPages&&(currentPage++,syncUrl(),loadArticles(currentPage))});let qTimer=null;qInput.addEventListener("input",()=>{q=qInput.value.trim(),qTimer&&clearTimeout(qTimer),qTimer=setTimeout(()=>{currentPage=1,syncUrl(),loadArticles(currentPage)},300)}),sortSel.addEventListener("change",()=>{sort=sortSel.value,currentPage=1,syncUrl(),loadArticles(currentPage)}),window.addEventListener("pageshow",t=>{const e=performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];(t.persisted||e&&"back_forward"===e.type)&&(readStateFromUrl(),loadArticles(currentPage))}),window.addEventListener("popstate",()=>{readStateFromUrl(),loadArticles(currentPage)}),readStateFromUrl(),syncUrl(),loadArticles(currentPage);
//# sourceMappingURL=main.js.map
